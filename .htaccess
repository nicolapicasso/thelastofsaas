<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Prevent loops - if already in public, stop
    RewriteCond %{ENV:REDIRECT_STATUS} ^$

    # If the request is not for a real file in the root
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d

    # Rewrite to public/index.php (internal, no URL change)
    RewriteRule ^ public/index.php [L,QSA]

    # For static assets, serve from public if they exist there
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{DOCUMENT_ROOT}/public/%{REQUEST_URI} -f
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# Security: deny access to sensitive files
<FilesMatch "^\.|(\.env|\.git|composer\.(json|lock)|package\.json)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order deny,allow
        Deny from all
    </IfModule>
</FilesMatch>
